package de.varylab.varylab.plugin.meshoptimizer;

import java.io.StringReader;

import de.jtem.halfedgetools.functional.Functional;
import de.jtem.jrworkspace.plugin.Controller;
import de.jtem.jrworkspace.plugin.PluginInfo;
import de.varylab.varylab.hds.VEdge;
import de.varylab.varylab.hds.VFace;
import de.varylab.varylab.hds.VHDS;
import de.varylab.varylab.hds.VVertex;
import de.varylab.varylab.math.functional.NURBSSurfaceFunctional;
import de.varylab.varylab.plugin.VarylabOptimizerPlugin;
import de.varylab.varylab.plugin.io.NurbsIO;
import de.varylab.varylab.plugin.nurbs.NURBSSurface;

public class NURBSSurfaceOptimizer extends VarylabOptimizerPlugin {

	private NURBSSurfaceFunctional<VVertex, VEdge, VFace> 
		functional = new NURBSSurfaceFunctional<VVertex, VEdge, VFace>();
	private NURBSSurface
		S = null;
	
	@Override
	public Functional<VVertex, VEdge, VFace> getFunctional(VHDS hds) {
		functional.setNURBSSurface(S);
		return functional;
	}

	@Override
	public void install(Controller c) throws Exception {
		super.install(c);
		StringReader sphereReader = new StringReader(nurbsSphere);
		S = NurbsIO.readNURBS(sphereReader);
	}
	

	@Override
	public String getName() {
		return "NURBS Reference Surface";
	}

	@Override
	public PluginInfo getPluginInfo() {
		PluginInfo info = new PluginInfo("NURBS Reference Surface", "Varylab Group");
		return info;
	}
	
	
	private String
		nurbsSphere = "# Rhino\n" + 
		"\n" + 
		"# - trim loop\n" + 
		"vp 0 -1.570796326794897\n" + 
		"vp 6.283185307179586 -1.570796326794897\n" + 
		"cstype bspline\n" + 
		"deg 1\n" + 
		"curv2 1 2\n" + 
		"parm u 0 0 6.283185307179586 6.283185307179586\n" + 
		"end\n" + 
		"vp 6.283185307179586 -1.570796326794897\n" + 
		"vp 6.283185307179586 1.570796326794897\n" + 
		"cstype bspline\n" + 
		"deg 1\n" + 
		"curv2 3 4\n" + 
		"parm u -1.570796326794897 -1.570796326794897 1.570796326794897 1.570796326794897\n" + 
		"end\n" + 
		"vp 6.283185307179586 1.570796326794897\n" + 
		"vp 0 1.570796326794897\n" + 
		"cstype bspline\n" + 
		"deg 1\n" + 
		"curv2 5 6\n" + 
		"parm u 0 0 6.283185307179586 6.283185307179586\n" + 
		"end\n" + 
		"vp 0 1.570796326794897\n" + 
		"vp 0 -1.570796326794897\n" + 
		"cstype bspline\n" + 
		"deg 1\n" + 
		"curv2 7 8\n" + 
		"parm u -1.570796326794897 -1.570796326794897 1.570796326794897 1.570796326794897\n" + 
		"end\n" + 
		"v 0.3629635802027999 11.03719669539025 0.3266672221825198 1\n" + 
		"v 0.3629635802027998 11.03719669539025 0.3266672221825198 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 0.3629635802027999 11.03719669539025 0.3266672221825198 1\n" + 
		"v 0.3629635802027998 11.03719669539025 0.3266672221825198 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 0.3629635802027999 11.03719669539025 0.3266672221825198 1\n" + 
		"v 0.3629635802027998 11.03719669539025 0.3266672221825198 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 0.3629635802027999 11.03719669539025 0.3266672221825198 1\n" + 
		"v 0.3629635802027998 11.03719669539025 0.3266672221825198 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 0.3629635802027999 11.03719669539025 0.3266672221825198 1\n" + 
		"v 8.275569628623801 11.03719669539025 -7.368160678116802 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 15.97039752892312 11.03719669539025 0.544445370304197 \\\n" + 
		" 0.5000000000000001\n" + 
		"v 8.057791480502123 11.03719669539025 8.239273270603521 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 0.1451854320811227 11.03719669539025 15.93410117090284 \\\n" + 
		" 0.5000000000000001\n" + 
		"v -7.549642468218201 11.03719669539025 8.021495122481843 \\\n" + 
		" 0.7071067811865476\n" + 
		"v -15.24447036851752 11.03719669539025 0.1088890740608426 \\\n" + 
		" 0.5000000000000001\n" + 
		"v -7.331864320096525 11.03719669539025 -7.58593882623848 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 0.5807417283244762 11.03719669539025 -15.2807667265378 \\\n" + 
		" 0.5000000000000001\n" + 
		"v 8.275569628623801 11.03719669539025 -7.368160678116802 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 8.275569628623803 6.758333802284709e-16 -7.368160678116804 1\n" + 
		"v 15.97039752892312 6.758333802284709e-16 0.544445370304197 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 8.057791480502125 6.758333802284709e-16 8.239273270603523 1\n" + 
		"v 0.1451854320811227 6.758333802284709e-16 15.93410117090285 \\\n" + 
		" 0.7071067811865476\n" + 
		"v -7.549642468218202 6.758333802284709e-16 8.021495122481845 1\n" + 
		"v -15.24447036851753 6.758333802284709e-16 0.1088890740608426 \\\n" + 
		" 0.7071067811865476\n" + 
		"v -7.331864320096526 6.758333802284709e-16 -7.585938826238482 1\n" + 
		"v 0.5807417283244762 6.758333802284709e-16 -15.2807667265378 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 8.275569628623803 6.758333802284709e-16 -7.368160678116804 1\n" + 
		"v 8.275569628623803 -11.03719669539025 -7.368160678116804 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 15.97039752892312 -11.03719669539025 0.544445370304197 \\\n" + 
		" 0.5000000000000001\n" + 
		"v 8.057791480502125 -11.03719669539025 8.239273270603523 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 0.1451854320811227 -11.03719669539025 15.93410117090284 \\\n" + 
		" 0.5000000000000001\n" + 
		"v -7.549642468218202 -11.03719669539025 8.021495122481845 \\\n" + 
		" 0.7071067811865476\n" + 
		"v -15.24447036851752 -11.03719669539025 0.1088890740608426 \\\n" + 
		" 0.5000000000000001\n" + 
		"v -7.331864320096526 -11.03719669539025 -7.585938826238482 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 0.5807417283244762 -11.03719669539025 -15.2807667265378 \\\n" + 
		" 0.5000000000000001\n" + 
		"v 8.275569628623803 -11.03719669539025 -7.368160678116804 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 0.3629635802027999 -11.03719669539025 0.3266672221825198 1\n" + 
		"v 0.3629635802027998 -11.03719669539025 0.3266672221825198 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 0.3629635802027999 -11.03719669539025 0.3266672221825198 1\n" + 
		"v 0.3629635802027998 -11.03719669539025 0.3266672221825198 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 0.3629635802027999 -11.03719669539025 0.3266672221825198 1\n" + 
		"v 0.3629635802027998 -11.03719669539025 0.3266672221825198 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 0.3629635802027999 -11.03719669539025 0.3266672221825198 1\n" + 
		"v 0.3629635802027998 -11.03719669539025 0.3266672221825198 \\\n" + 
		" 0.7071067811865476\n" + 
		"v 0.3629635802027999 -11.03719669539025 0.3266672221825198 1\n" + 
		"cstype rat bspline\n" + 
		"deg 2 2\n" + 
		"surf 0 6.283185307179586 -1.570796326794897 1.570796326794897 1 2 \\\n" + 
		" 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 \\\n" + 
		" 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45\n" + 
		"parm u 0 0 0 1.570796326794897 1.570796326794897 3.141592653589793 \\\n" + 
		" 3.141592653589793 4.71238898038469 4.71238898038469 6.283185307179586 \\\n" + 
		" 6.283185307179586 6.283185307179586\n" + 
		"parm v -1.570796326794897 -1.570796326794897 -1.570796326794897 0 \\\n" + 
		" 0 1.570796326794897 1.570796326794897 1.570796326794897\n" + 
		"trim 0 6.283185307179586 1 -1.570796326794897 1.570796326794897 2 \\\n" + 
		" 0 6.283185307179586 3 -1.570796326794897 1.570796326794897 4\n" + 
		"end\n" + 
		"";

}
